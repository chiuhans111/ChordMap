(function(){"use strict";var e={3934:function(e,n,t){var o=t(9242),i=t(3396),r=t(7139);const a={ref:"piano_container"},l={class:"piano_container-note_name"},s={class:"note_octave"},c={class:"piano_container-keyboard"},u=["onClick"],y={class:"piano_container-editor"},f=["onClick"],m={class:"ratio_hint"},p=["onClick"];function d(e,n,t,d,h,_){return(0,i.wg)(),(0,i.iD)("div",null,[(0,i._)("section",null,[(0,i._)("button",{onClick:n[0]||(n[0]=e=>_.playEnabledKeys())},"Play Enabled Keys")]),(0,i._)("section",null,[(0,i._)("div",a,[(0,i._)("div",l,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(h.pianoKeys,(e=>((0,i.wg)(),(0,i.iD)("div",{style:(0,r.j5)(e.containerStyle),key:e.index},[(0,i._)("span",null,(0,r.zw)(e.name),1),(0,i._)("span",s,(0,r.zw)(e.octave),1)],4)))),128))]),(0,i._)("div",c,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(h.pianoKeys,(e=>((0,i.wg)(),(0,i.iD)("div",{style:(0,r.j5)(e.keyStyle),class:(0,r.C_)([e.cssClass,"note_body"]),key:e.index,onClick:(0,o.iM)((n=>_.pianoKeyClick(e)),["prevent"])},(0,r.zw)(e.name),15,u)))),128))]),(0,i._)("div",y,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(h.pianoKeys,(e=>((0,i.wg)(),(0,i.iD)("div",{style:(0,r.j5)(e.containerStyle),class:(0,r.C_)([e.cssClass,"note_box"]),key:e.index,onClick:(0,o.iM)((n=>_.editorKeyClick(e)),["prevent"])},[(0,i._)("div",{class:(0,r.C_)({note_enable:e.enable})},(0,r.zw)(e.enable),3)],14,f)))),128))])],512)]),(0,i._)("section",null,[(0,i._)("div",m,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(h.analyzeResult.hints,((e,n)=>((0,i.wg)(),(0,i.iD)("div",{class:(0,r.C_)(["ratio_hint-row",{harmonized:e.harmonized}]),key:n,onClick:n=>_.playHint(e)},[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(e.nodes,((e,n)=>((0,i.wg)(),(0,i.iD)("div",{class:(0,r.C_)(["ratio_hint-node",e.cssClass]),style:(0,r.j5)(e.style),key:n},[e.cssClass["node_is_minimize"]?(0,i.kq)("",!0):((0,i.wg)(),(0,i.iD)(i.HY,{key:0},[(0,i.Uk)((0,r.zw)(e.ratio),1)],64))],6)))),128))],10,p)))),128))])])])}t(7658);let h=[];const _=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],k=[0,0,1,1,2,3,3,4,4,5,5,6],v=[!1,!0,!1,!0,!1,!1,!0,!1,!0,!1,!0,!1],b=440,g={};let w=35;for(let Z=0;Z<12;Z++){const e=_[Z];g[e]=Z}function x(e,n){return g[e]+12*n}function C(e){return b*2**((e-D)/12)}function q(e){return 12*Math.log2(e/b)+D}function K(e){return(e+.5)%12-.5}function T(e){return _[Math.round(K(e))]}const z=x("C",3),A=x("B",6),D=x("A",4);for(let Z=z;Z<=A;Z++){const e=_[Z%12],n=v[Z%12],t={name:e,index:Z,octave:Math.floor(Z/12),isWhiteKey:!n,isBlackKey:n,frequency:C(Z),enable:!1,containerStyle:{position:"absolute"},keyStyle:{position:"absolute"},cssClass:{note_is_white:!n,note_is_black:n}};h.push(t)}function F(e){return(e-z)*w}function M(){const e=12*w,n=e/7;for(let t of h){let e=F(t.index);if(t.containerStyle.left=e+"px",t.containerStyle.width=w+"px",t.isWhiteKey){const o=k[t.index%12]*n,i=t.index%12*w;t.keyStyle.left=e+o-i+"px",t.keyStyle.width=n+"px"}else t.keyStyle.left=e+"px",t.keyStyle.width=w+"px"}}M();var j={pianoKeys:h,frequency2index:q,wrapToneNumber:K,nearestToneName:T,keyid_start:z,keyid_end:A,index2Xoffset:F};const O=new window.AudioContext;function S(e,n,t,o,i,r,a){const l=e.createGain();return l.gain.setValueAtTime(0,e.currentTime),l.gain.linearRampToValueAtTime(n,e.currentTime+t),l.gain.linearRampToValueAtTime(n*i,e.currentTime+t+o),l.gain.linearRampToValueAtTime(n*i,e.currentTime+a-r),l.gain.linearRampToValueAtTime(0,e.currentTime+a),l}let N=[];function H(e,n){N.splice(0,N.length);for(let t of e){const e=O.createOscillator();e.frequency.setValueAtTime(t,O.currentTime);const o=S(O,.2,.001,.1,.5,.1,n);e.connect(o),o.connect(O.destination),e.start(O.currentTime),e.stop(O.currentTime+n),N.push(e)}}var R={playNotes:H};function V(e){let n="ðŸ˜„";return e>2.5&&(n="ðŸ˜€"),e>4.5&&(n="ðŸ˜Š"),e>5.5&&(n="ðŸ˜”"),e>8.5&&(n="ðŸ˜ž"),e>12.5&&(n="ðŸ˜¢"),n}function Y(e,n){return Array.isArray(e)?e.length<=1?e[0]:Y(e[0],Y(e.slice(1))):0===n?e:Y(n,e%n)}function E(e=[],n=[],t=.01){let o=[];if(null!==n&&0!=n.length||(n=e.map((()=>1))),0==e.length)return[];if(1==e.length)o.push({ratio:[1],commonFrequency:e[0],mse:0});else{let i=e.reduce(((e,n)=>Math.min(e,n))),r={};for(let a=0;a<30;a++){n=e.map((e=>Math.round(e/i)));const a=Y(n);if(n=n.map((e=>e/a)),n.some((e=>e>35)))break;const l=n.join(":");if(!r[l]){r[l]=!0;const i=e.map(((e,t)=>e/n[t])),a=i.reduce(((e,n)=>e+n),0)/i.length,s=e.map(((e,t)=>12*Math.log2(e/(a*n[t])))),c=Math.sqrt(s.map((e=>e*e)).reduce(((e,n)=>e+n),0));if(c<1&&o.push({ratio:n.map((e=>e)),commonFrequency:a,mse:c}),c<t)break}let s=e.map((e=>e%i)).reduce(((e,n)=>Math.max(e,n)));i=(i+s)/2}}o.sort(((e,n)=>{const t=e.mse-n.mse;return Math.abs(t)<.5?-e.commonFrequency+n.commonFrequency:t}));let i=[];for(let r of o){i.push({ratio:r.ratio.map((e=>e)),commonFrequency:r.commonFrequency,mse:r.mse,harmonized:!1});for(let e=2;e<=Math.min(35/r.ratio[r.ratio.length-1],6);e++)i.push({ratio:r.ratio.map((n=>n*e)),commonFrequency:r.commonFrequency/e,mse:r.mse,harmonized:!0})}o=i;for(let r of o)r.key=j.frequency2index(r.commonFrequency),r.keyName=j.nearestToneName(r.key);return o}function B(e=[]){let n=E(e),t=[];for(let o of n){let e=[];for(let n=1;n<=Math.max(o.ratio[o.ratio.length-1],100);n++){const t=n*o.commonFrequency,i=j.frequency2index(t),r=o.ratio.includes(n);i<j.keyid_start-1||i>j.keyid_end+1||e.push({ratio:n,style:{position:"absolute",left:j.index2Xoffset(i+.5)+"px"},cssClass:{node_is_key:r,node_is_minimize:!r&&n>35||o.harmonized}})}Object.freeze(e),t.push({nodes:e,frequencies:o.ratio.map((e=>e*o.commonFrequency)),harmonized:o.harmonized})}return{frequencies:e,results:n,hints:t}}var G={analyze:B,ratio2emoji:V},P={name:"App",data(){return{pianoKeys:j.pianoKeys,analyzeResult:{}}},components:{},mounted(){},methods:{pianoKeyClick(e){R.playNotes([e.frequency],.5)},editorKeyClick(e){e.enable=!e.enable,R.playNotes([e.frequency],.5),this.updateAnalyze()},playEnabledKeys(){R.playNotes(j.pianoKeys.filter((e=>e.enable)).map((e=>e.frequency)),.5)},updateAnalyze(){this.analyzeResult=G.analyze(j.pianoKeys.filter((e=>e.enable)).map((e=>e.frequency)))},playHint(e){R.playNotes(e.frequencies,.5)}},computed:{}},W=t(89);const X=(0,W.Z)(P,[["render",d]]);var U=X;(0,o.ri)(U).mount("#app")}},n={};function t(o){var i=n[o];if(void 0!==i)return i.exports;var r=n[o]={exports:{}};return e[o].call(r.exports,r,r.exports,t),r.exports}t.m=e,function(){var e=[];t.O=function(n,o,i,r){if(!o){var a=1/0;for(u=0;u<e.length;u++){o=e[u][0],i=e[u][1],r=e[u][2];for(var l=!0,s=0;s<o.length;s++)(!1&r||a>=r)&&Object.keys(t.O).every((function(e){return t.O[e](o[s])}))?o.splice(s--,1):(l=!1,r<a&&(a=r));if(l){e.splice(u--,1);var c=i();void 0!==c&&(n=c)}}return n}r=r||0;for(var u=e.length;u>0&&e[u-1][2]>r;u--)e[u]=e[u-1];e[u]=[o,i,r]}}(),function(){t.n=function(e){var n=e&&e.__esModule?function(){return e["default"]}:function(){return e};return t.d(n,{a:n}),n}}(),function(){t.d=function(e,n){for(var o in n)t.o(n,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:n[o]})}}(),function(){t.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)}}(),function(){var e={143:0};t.O.j=function(n){return 0===e[n]};var n=function(n,o){var i,r,a=o[0],l=o[1],s=o[2],c=0;if(a.some((function(n){return 0!==e[n]}))){for(i in l)t.o(l,i)&&(t.m[i]=l[i]);if(s)var u=s(t)}for(n&&n(o);c<a.length;c++)r=a[c],t.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return t.O(u)},o=self["webpackChunkchordmap"]=self["webpackChunkchordmap"]||[];o.forEach(n.bind(null,0)),o.push=n.bind(null,o.push.bind(o))}();var o=t.O(void 0,[998],(function(){return t(3934)}));o=t.O(o)})();
//# sourceMappingURL=app.67a3e289.js.map