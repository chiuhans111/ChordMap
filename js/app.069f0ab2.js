(function(){"use strict";var e={4180:function(e,n,t){var i=t(9242),o=t(3396),r=t(7139);const a={class:"scroll_horizontal"},s={class:"piano_container-note_name"},l={class:"note_octave"},c={class:"piano_container-keyboard"},u=["onClick"],m={class:"piano_container-editor"},p=["onClick"],y=["onClick"];function d(e,n,t,d,f,h){return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("section",null,[(0,o._)("button",{onClick:n[0]||(n[0]=e=>h.playEnabledKeys())},"Play Enabled Keys"),(0,o.Uk)(" "+(0,r.zw)(f.pitchClass)+" ",1),(0,o._)("button",{onClick:n[1]||(n[1]=e=>h.clearAllKeys())},"Clear All Keys")]),(0,o._)("section",null,[(0,o._)("div",a,[(0,o._)("div",{class:"piano_container",style:(0,r.j5)({width:f.fullWidth+"px"})},[(0,o._)("div",s,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(f.pianoKeys,(e=>((0,o.wg)(),(0,o.iD)("div",{style:(0,r.j5)(e.containerStyle),key:e.index},[(0,o._)("span",null,(0,r.zw)(e.name),1),(0,o._)("span",l,(0,r.zw)(e.octave),1)],4)))),128))]),(0,o._)("div",c,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(f.pianoKeys,(e=>((0,o.wg)(),(0,o.iD)("div",{style:(0,r.j5)(e.keyStyle),class:(0,r.C_)([e.cssClass,"note_body"]),key:e.index,onClick:(0,i.iM)((n=>h.pianoKeyClick(e)),["prevent"])},null,14,u)))),128))]),(0,o._)("div",m,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(f.pianoKeys,(e=>((0,o.wg)(),(0,o.iD)("div",{style:(0,r.j5)(e.containerStyle),class:(0,r.C_)([e.cssClass,"note_box"]),key:e.index,onClick:(0,i.iM)((n=>h.editorKeyClick(e)),["prevent"])},[(0,o._)("div",{class:(0,r.C_)([{note_enable:e.enable},"note_box-tag"])},(0,r.zw)(e.name)+" ",3)],14,p)))),128))])],4),(0,o._)("div",{class:"ratio_hint",style:(0,r.j5)({width:f.fullWidth+"px"})},[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(f.analyzeResult.hints,((e,n)=>((0,o.wg)(),(0,o.iD)("div",{class:(0,r.C_)(["ratio_hint-row",{is_higher_harmonics:e.isHigherHarmonics}]),key:n,onClick:n=>h.playHint(e)},[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.nodes,((e,n)=>((0,o.wg)(),(0,o.iD)("div",{class:(0,r.C_)(["ratio_hint-node",e.cssClass]),style:(0,r.j5)(e.style),key:n},[e.cssClass["node_is_minimize"]?(0,o.kq)("",!0):((0,o.wg)(),(0,o.iD)(o.HY,{key:0},[(0,o.Uk)((0,r.zw)(e.ratio),1)],64))],6)))),128))],10,y)))),128))],4)])])])}t(6229),t(7330),t(2062),t(7658);let f=[];const h=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],_=[0,0,1,1,2,3,3,4,4,5,5,6],v=[!1,!0,!1,!0,!1,!1,!0,!1,!0,!1,!0,!1],g=440,w={};let k=35;for(let L=0;L<12;L++){const e=h[L];w[e]=L}function x(e,n){return w[e]+12*n}function b(e){return g*2**((e-O)/12)}function C(e){return 12*Math.log2(e/g)+O}function K(e){return(e+.5)%12-.5}function q(e){return h[Math.round(K(e))]}const H=x("C",2),M=x("B",7),A=(M-H+1)*k,O=x("A",4);for(let L=H;L<=M;L++){const e=h[L%12],n=v[L%12],t={name:e,index:L,octave:Math.floor(L/12),isWhiteKey:!n,isBlackKey:n,frequency:b(L),enable:!1,containerStyle:{position:"absolute"},keyStyle:{position:"absolute"},cssClass:{note_is_white:!n,note_is_black:n}};f.push(t)}function T(e){return(e-H)*k}function z(){const e=12*k,n=e/7;for(let t of f){let e=T(t.index);if(t.containerStyle.left=e+"px",t.containerStyle.width=k+"px",t.isWhiteKey){const i=_[t.index%12]*n,o=t.index%12*k;t.keyStyle.left=e+i-o+"px",t.keyStyle.width=n+"px"}else t.keyStyle.left=e+"px",t.keyStyle.width=k+"px"}}z();var F={pianoKeys:f,frequency2index:C,wrapToneNumber:K,nearestToneName:q,keyid_start:H,keyid_end:M,index2Xoffset:T,fullWidth:A};const j=new window.AudioContext;function D(e,n,t,i,o,r,a){const s=e.createGain();return s.gain.setValueAtTime(0,e.currentTime),s.gain.linearRampToValueAtTime(n,e.currentTime+t),s.gain.linearRampToValueAtTime(n*o,e.currentTime+t+i),s.gain.linearRampToValueAtTime(n*o,e.currentTime+a-r),s.gain.linearRampToValueAtTime(0,e.currentTime+a),s}let S=[];function U(e,n){S.splice(0,S.length);for(let t of e){const e=j.createOscillator();e.frequency.setValueAtTime(t,j.currentTime);const i=D(j,.2,.001,.1,.5,.1,n);e.connect(i),i.connect(j.destination),e.start(j.currentTime),e.stop(j.currentTime+n),S.push(e)}}var R={playNotes:U};function N(e){let n="ðŸ˜„";return e>2.5&&(n="ðŸ˜€"),e>4.5&&(n="ðŸ˜Š"),e>5.5&&(n="ðŸ˜”"),e>8.5&&(n="ðŸ˜ž"),e>12.5&&(n="ðŸ˜¢"),n}function W(e,n){return Array.isArray(e)?0==e.length?1:1==e.length?e[0]:W(e[0],W(e.slice(1))):0===n?e:W(n,e%n)}function P(e,n){return Array.isArray(e)?0==e.length?0:1==e.length?e[0]:P(e[0],P(e.slice(1))):e*n/W(e,n)}function V(e,n){const t=P(n),i=Math.log2(t),o=e.map((e=>12*Math.log2(e))),r=n.map((e=>12*Math.log2(e))),a=o.map(((e,n)=>e-r[n])).reduce(((e,n)=>e+n),0)/o.length,s=2**(a/12),l=o.map(((e,n)=>e-a-r[n])),c=Math.sqrt(l.map((e=>e*e)).reduce(((e,n)=>e+n),0)/l.length),u=12*i,m=Math.min(...r)<=u/2,p=Math.max(...r)>=u/2,y=Math.min(...n,...n.map((e=>t/e))),d=c<.2&&i<14&&y<20,f=98*c+y+.8*i;return{lcm:t,rmse:c,r0:y,complexity:i,isOvertone:m,isUndertone:p,valid:d,merit:f,commonFrequency:s}}function Y(e=[]){let n=[];if(0==e.length)return[];if(1==e.length)n.push({ratio:[1],lcm:1,commonFrequency:e[0],rmse:0,merit:0,isOvertone:!0,isUndertone:!0});else{let t={};const i=Math.min(...e);let o=e.map((e=>Math.floor(e/i)));for(let a=0;a<30;a++){const i=Math.max(...e.map(((e,n)=>e/(o[n]+1))));o=e.map((e=>Math.round(e/i)));const r=W(o),a=o.map((e=>e/r)),s=a.join(":");if(!t[s]){t[s]=!0;const i=V(e,a);i.valid&&n.push({ratio:a.map((e=>e)),lcm:i.lcm,commonFrequency:i.commonFrequency,rmse:i.rmse,merit:i.merit,isOvertone:i.isOvertone,isUndertone:i.isUndertone})}}const r=Math.max(...e);o=e.map((e=>Math.floor(r/e)));for(let a=0;a<30;a++){const i=Math.min(...e.map(((e,n)=>e*(o[n]+1))));o=e.map((e=>Math.round(i/e)));const r=o.reduce(((e,n)=>e*n),1),a=o.map((e=>Math.round(r/e))),s=W(a),l=a.map((e=>e/s)),c=l.join(":");if(!t[c]){t[c]=!0;const i=V(e,l);i.valid&&n.push({ratio:l.map((e=>e)),lcm:i.lcm,commonFrequency:i.commonFrequency,rmse:i.rmse,merit:i.merit,isOvertone:i.isOvertone,isUndertone:i.isUndertone})}}}return n.sort(((e,n)=>e.merit-n.merit)),n.splice(0,3)}function E(e=[]){let n=Y(e),t=[];for(let o=0;o<n.length;o++){const e=n[o],i=0==o?4:1;if(e.isOvertone)for(let n=1;n<=i;n++)t.push({ratio:e.ratio.map((e=>e*n)),lcm:e.lcm,commonFrequency:e.commonFrequency/n,isHigherHarmonics:n>1,isOvertone:!0,isUndertone:!1});if(e.isUndertone)for(let n=1;n<=i;n++)t.push({ratio:e.ratio,lcm:e.lcm*n,commonFrequency:e.commonFrequency,isHigherHarmonics:n>1,isOvertone:!1,isUndertone:!0})}let i=[];for(let o of t){if(o.isOvertone){let e=[];const n=Math.max(35,...o.ratio);for(let t=1;t<=n;t++){const n=t*o.commonFrequency,i=F.frequency2index(n),r=o.ratio.includes(t);i<F.keyid_start-1||i>F.keyid_end+1||(r||t<100)&&e.push({ratio:t,frequency:n,index:i,isKey:r,style:{position:"absolute",left:F.index2Xoffset(i+.5)+"px"},cssClass:{node_is_key:r,node_is_minimize:!r&&t>35||o.isHigherHarmonics,node_is_overtone:!0}})}i.push({nodes:e,frequencies:o.ratio.map((e=>e*o.commonFrequency)),isHigherHarmonics:o.isHigherHarmonics})}if(o.isUndertone){let e=[];const n=o.ratio.map((e=>o.lcm/e)),t=Math.max(35,...n);for(let i=1;i<=t;i++){const t=o.lcm/i,r=t*o.commonFrequency,a=F.frequency2index(r),s=n.includes(i);a<F.keyid_start-1||a>F.keyid_end+1||(s||i<100)&&e.push({ratio:i,frequency:r,index:a,isKey:s,style:{position:"absolute",left:F.index2Xoffset(a+.5)+"px"},cssClass:{node_is_key:s,node_is_minimize:!s&&i>35||o.isHigherHarmonics,node_is_undertone:!0}})}i.push({nodes:e,frequencies:o.ratio.map((e=>e*o.commonFrequency)),isHigherHarmonics:o.isHigherHarmonics})}}return{frequencies:e,results:n,hints:i}}var $={analyze:E,ratio2emoji:N},B={name:"App",data(){return{pianoKeys:F.pianoKeys,analyzeResult:{},pitchClass:[],fullWidth:F.fullWidth}},components:{},mounted(){const e=new URLSearchParams(window.location.search),n=e.get("keys");try{const e=n.split(",").map((e=>parseInt(e)));for(let n of this.pianoKeys)n.enable=e.includes(n.index);this.updateAnalyze()}catch(t){console.log("parameter parsing failed")}console.log("keys:",n)},methods:{clearAllKeys(){for(let e of this.pianoKeys)e.enable=!1;this.updateAnalyze()},pianoKeyClick(e){R.playNotes([e.frequency],.5)},editorKeyClick(e){e.enable=!e.enable,R.playNotes([e.frequency],.5),this.updateAnalyze()},playEnabledKeys(){R.playNotes(F.pianoKeys.filter((e=>e.enable)).map((e=>e.frequency)),.5)},updateAnalyze(){this.updateParams(),this.analyzeResult=$.analyze(F.pianoKeys.filter((e=>e.enable)).map((e=>e.frequency)));let e=F.pianoKeys.filter((e=>e.enable)).map((e=>e.index));e=e.map((n=>n-e[0])),this.pitchClass=e},updateParams(){const e=F.pianoKeys.filter((e=>e.enable)).map((e=>e.index)).join(","),n=`${window.location.protocol}//${window.location.host}${window.location.pathname}?keys=${e}`;window.history.pushState({},"",n)},playHint(e){R.playNotes(e.frequencies,.5)}},computed:{}},G=t(89);const X=(0,G.Z)(B,[["render",d]]);var I=X;(0,i.ri)(I).mount("#app")}},n={};function t(i){var o=n[i];if(void 0!==o)return o.exports;var r=n[i]={exports:{}};return e[i].call(r.exports,r,r.exports,t),r.exports}t.m=e,function(){var e=[];t.O=function(n,i,o,r){if(!i){var a=1/0;for(u=0;u<e.length;u++){i=e[u][0],o=e[u][1],r=e[u][2];for(var s=!0,l=0;l<i.length;l++)(!1&r||a>=r)&&Object.keys(t.O).every((function(e){return t.O[e](i[l])}))?i.splice(l--,1):(s=!1,r<a&&(a=r));if(s){e.splice(u--,1);var c=o();void 0!==c&&(n=c)}}return n}r=r||0;for(var u=e.length;u>0&&e[u-1][2]>r;u--)e[u]=e[u-1];e[u]=[i,o,r]}}(),function(){t.n=function(e){var n=e&&e.__esModule?function(){return e["default"]}:function(){return e};return t.d(n,{a:n}),n}}(),function(){t.d=function(e,n){for(var i in n)t.o(n,i)&&!t.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:n[i]})}}(),function(){t.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)}}(),function(){var e={143:0};t.O.j=function(n){return 0===e[n]};var n=function(n,i){var o,r,a=i[0],s=i[1],l=i[2],c=0;if(a.some((function(n){return 0!==e[n]}))){for(o in s)t.o(s,o)&&(t.m[o]=s[o]);if(l)var u=l(t)}for(n&&n(i);c<a.length;c++)r=a[c],t.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return t.O(u)},i=self["webpackChunkchordmap"]=self["webpackChunkchordmap"]||[];i.forEach(n.bind(null,0)),i.push=n.bind(null,i.push.bind(i))}();var i=t.O(void 0,[998],(function(){return t(4180)}));i=t.O(i)})();
//# sourceMappingURL=app.069f0ab2.js.map